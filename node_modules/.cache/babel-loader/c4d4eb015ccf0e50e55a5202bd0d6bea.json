{"ast":null,"code":"import _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { useContext } from '@rc-component/context';\nimport VirtualList from 'rc-virtual-list';\nimport * as React from 'react';\nimport TableContext, { responseImmutable } from \"../context/TableContext\";\nimport useFlattenRecords from \"../hooks/useFlattenRecords\";\nimport BodyLine from \"./BodyLine\";\nimport { GridContext, StaticContext } from \"./context\";\nvar Grid = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  var data = props.data,\n      onScroll = props.onScroll;\n\n  var _useContext = useContext(TableContext, ['flattenColumns', 'onColumnResize', 'getRowKey', 'prefixCls', 'expandedKeys', 'childrenColumnName', 'scrollX', 'direction']),\n      flattenColumns = _useContext.flattenColumns,\n      onColumnResize = _useContext.onColumnResize,\n      getRowKey = _useContext.getRowKey,\n      expandedKeys = _useContext.expandedKeys,\n      prefixCls = _useContext.prefixCls,\n      childrenColumnName = _useContext.childrenColumnName,\n      scrollX = _useContext.scrollX,\n      direction = _useContext.direction;\n\n  var _useContext2 = useContext(StaticContext),\n      sticky = _useContext2.sticky,\n      scrollY = _useContext2.scrollY,\n      listItemHeight = _useContext2.listItemHeight,\n      getComponent = _useContext2.getComponent,\n      onTablePropScroll = _useContext2.onScroll; // =========================== Ref ============================\n\n\n  var listRef = React.useRef(); // =========================== Data ===========================\n\n  var flattenData = useFlattenRecords(data, childrenColumnName, expandedKeys, getRowKey); // ========================== Column ==========================\n\n  var columnsWidth = React.useMemo(function () {\n    var total = 0;\n    return flattenColumns.map(function (_ref) {\n      var width = _ref.width,\n          key = _ref.key;\n      total += width;\n      return [key, width, total];\n    });\n  }, [flattenColumns]);\n  var columnsOffset = React.useMemo(function () {\n    return columnsWidth.map(function (colWidth) {\n      return colWidth[2];\n    });\n  }, [columnsWidth]);\n  React.useEffect(function () {\n    columnsWidth.forEach(function (_ref2) {\n      var _ref3 = _slicedToArray(_ref2, 2),\n          key = _ref3[0],\n          width = _ref3[1];\n\n      onColumnResize(key, width);\n    });\n  }, [columnsWidth]); // =========================== Ref ============================\n\n  React.useImperativeHandle(ref, function () {\n    var _listRef$current2;\n\n    var obj = {\n      scrollTo: function scrollTo(config) {\n        var _listRef$current;\n\n        (_listRef$current = listRef.current) === null || _listRef$current === void 0 || _listRef$current.scrollTo(config);\n      },\n      nativeElement: (_listRef$current2 = listRef.current) === null || _listRef$current2 === void 0 ? void 0 : _listRef$current2.nativeElement\n    };\n    Object.defineProperty(obj, 'scrollLeft', {\n      get: function get() {\n        var _listRef$current3;\n\n        return ((_listRef$current3 = listRef.current) === null || _listRef$current3 === void 0 ? void 0 : _listRef$current3.getScrollInfo().x) || 0;\n      },\n      set: function set(value) {\n        var _listRef$current4;\n\n        (_listRef$current4 = listRef.current) === null || _listRef$current4 === void 0 || _listRef$current4.scrollTo({\n          left: value\n        });\n      }\n    });\n    return obj;\n  }); // ======================= Col/Row Span =======================\n\n  var getRowSpan = function getRowSpan(column, index) {\n    var _flattenData$index;\n\n    var record = (_flattenData$index = flattenData[index]) === null || _flattenData$index === void 0 ? void 0 : _flattenData$index.record;\n    var onCell = column.onCell;\n\n    if (onCell) {\n      var _cellProps$rowSpan;\n\n      var cellProps = onCell(record, index);\n      return (_cellProps$rowSpan = cellProps === null || cellProps === void 0 ? void 0 : cellProps.rowSpan) !== null && _cellProps$rowSpan !== void 0 ? _cellProps$rowSpan : 1;\n    }\n\n    return 1;\n  };\n\n  var extraRender = function extraRender(info) {\n    var start = info.start,\n        end = info.end,\n        getSize = info.getSize,\n        offsetY = info.offsetY; // Do nothing if no data\n\n    if (end < 0) {\n      return null;\n    } // Find first rowSpan column\n\n\n    var firstRowSpanColumns = flattenColumns.filter( // rowSpan is 0\n    function (column) {\n      return getRowSpan(column, start) === 0;\n    });\n    var startIndex = start;\n\n    var _loop = function _loop(i) {\n      firstRowSpanColumns = firstRowSpanColumns.filter(function (column) {\n        return getRowSpan(column, i) === 0;\n      });\n\n      if (!firstRowSpanColumns.length) {\n        startIndex = i;\n        return 1; // break\n      }\n    };\n\n    for (var i = start; i >= 0; i -= 1) {\n      if (_loop(i)) break;\n    } // Find last rowSpan column\n\n\n    var lastRowSpanColumns = flattenColumns.filter( // rowSpan is not 1\n    function (column) {\n      return getRowSpan(column, end) !== 1;\n    });\n    var endIndex = end;\n\n    var _loop2 = function _loop2(_i) {\n      lastRowSpanColumns = lastRowSpanColumns.filter(function (column) {\n        return getRowSpan(column, _i) !== 1;\n      });\n\n      if (!lastRowSpanColumns.length) {\n        endIndex = Math.max(_i - 1, end);\n        return 1; // break\n      }\n    };\n\n    for (var _i = end; _i < flattenData.length; _i += 1) {\n      if (_loop2(_i)) break;\n    } // Collect the line who has rowSpan\n\n\n    var spanLines = [];\n\n    var _loop3 = function _loop3(_i2) {\n      var item = flattenData[_i2]; // This code will never reach, just incase\n\n      if (!item) {\n        return 1; // continue\n      }\n\n      if (flattenColumns.some(function (column) {\n        return getRowSpan(column, _i2) > 1;\n      })) {\n        spanLines.push(_i2);\n      }\n    };\n\n    for (var _i2 = startIndex; _i2 <= endIndex; _i2 += 1) {\n      if (_loop3(_i2)) continue;\n    } // Patch extra line on the page\n\n\n    var nodes = spanLines.map(function (index) {\n      var item = flattenData[index];\n      var rowKey = getRowKey(item.record, index);\n\n      var getHeight = function getHeight(rowSpan) {\n        var endItemIndex = index + rowSpan - 1;\n        var endItemKey = getRowKey(flattenData[endItemIndex].record, endItemIndex);\n        var sizeInfo = getSize(rowKey, endItemKey);\n        return sizeInfo.bottom - sizeInfo.top;\n      };\n\n      var sizeInfo = getSize(rowKey);\n      return /*#__PURE__*/React.createElement(BodyLine, {\n        key: index,\n        data: item,\n        rowKey: rowKey,\n        index: index,\n        style: {\n          top: -offsetY + sizeInfo.top\n        },\n        extra: true,\n        getHeight: getHeight\n      });\n    });\n    return nodes;\n  }; // ========================= Context ==========================\n\n\n  var gridContext = React.useMemo(function () {\n    return {\n      columnsOffset: columnsOffset\n    };\n  }, [columnsOffset]); // ========================== Render ==========================\n\n  var tblPrefixCls = \"\".concat(prefixCls, \"-tbody\"); // default 'div' in rc-virtual-list\n\n  var wrapperComponent = getComponent(['body', 'wrapper']); // ========================== Sticky Scroll Bar ==========================\n\n  var horizontalScrollBarStyle = {};\n\n  if (sticky) {\n    horizontalScrollBarStyle.position = 'sticky';\n    horizontalScrollBarStyle.bottom = 0;\n\n    if (_typeof(sticky) === 'object' && sticky.offsetScroll) {\n      horizontalScrollBarStyle.bottom = sticky.offsetScroll;\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(GridContext.Provider, {\n    value: gridContext\n  }, /*#__PURE__*/React.createElement(VirtualList, {\n    fullHeight: false,\n    ref: listRef,\n    prefixCls: \"\".concat(tblPrefixCls, \"-virtual\"),\n    styles: {\n      horizontalScrollBar: horizontalScrollBarStyle\n    },\n    className: tblPrefixCls,\n    height: scrollY,\n    itemHeight: listItemHeight || 24,\n    data: flattenData,\n    itemKey: function itemKey(item) {\n      return getRowKey(item.record);\n    },\n    component: wrapperComponent,\n    scrollWidth: scrollX,\n    direction: direction,\n    onVirtualScroll: function onVirtualScroll(_ref4) {\n      var _listRef$current5;\n\n      var x = _ref4.x;\n      onScroll({\n        currentTarget: (_listRef$current5 = listRef.current) === null || _listRef$current5 === void 0 ? void 0 : _listRef$current5.nativeElement,\n        scrollLeft: x\n      });\n    },\n    onScroll: onTablePropScroll,\n    extraRender: extraRender\n  }, function (item, index, itemProps) {\n    var rowKey = getRowKey(item.record, index);\n    return /*#__PURE__*/React.createElement(BodyLine, {\n      data: item,\n      rowKey: rowKey,\n      index: index,\n      style: itemProps.style\n    });\n  }));\n});\nvar ResponseGrid = responseImmutable(Grid);\n\nif (process.env.NODE_ENV !== 'production') {\n  ResponseGrid.displayName = 'ResponseGrid';\n}\n\nexport default ResponseGrid;","map":{"version":3,"sources":["/Users/malith_bandara/Desktop/AdminDashboard/node_modules/rc-table/es/VirtualTable/BodyGrid.js"],"names":["_typeof","_slicedToArray","useContext","VirtualList","React","TableContext","responseImmutable","useFlattenRecords","BodyLine","GridContext","StaticContext","Grid","forwardRef","props","ref","data","onScroll","_useContext","flattenColumns","onColumnResize","getRowKey","expandedKeys","prefixCls","childrenColumnName","scrollX","direction","_useContext2","sticky","scrollY","listItemHeight","getComponent","onTablePropScroll","listRef","useRef","flattenData","columnsWidth","useMemo","total","map","_ref","width","key","columnsOffset","colWidth","useEffect","forEach","_ref2","_ref3","useImperativeHandle","_listRef$current2","obj","scrollTo","config","_listRef$current","current","nativeElement","Object","defineProperty","get","_listRef$current3","getScrollInfo","x","set","value","_listRef$current4","left","getRowSpan","column","index","_flattenData$index","record","onCell","_cellProps$rowSpan","cellProps","rowSpan","extraRender","info","start","end","getSize","offsetY","firstRowSpanColumns","filter","startIndex","_loop","i","length","lastRowSpanColumns","endIndex","_loop2","_i","Math","max","spanLines","_loop3","_i2","item","some","push","nodes","rowKey","getHeight","endItemIndex","endItemKey","sizeInfo","bottom","top","createElement","style","extra","gridContext","tblPrefixCls","concat","wrapperComponent","horizontalScrollBarStyle","position","offsetScroll","Provider","fullHeight","styles","horizontalScrollBar","className","height","itemHeight","itemKey","component","scrollWidth","onVirtualScroll","_ref4","_listRef$current5","currentTarget","scrollLeft","itemProps","ResponseGrid","process","env","NODE_ENV","displayName"],"mappings":"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","sourcesContent":["import _typeof from \"@babel/runtime/helpers/esm/typeof\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport { useContext } from '@rc-component/context';\nimport VirtualList from 'rc-virtual-list';\nimport * as React from 'react';\nimport TableContext, { responseImmutable } from \"../context/TableContext\";\nimport useFlattenRecords from \"../hooks/useFlattenRecords\";\nimport BodyLine from \"./BodyLine\";\nimport { GridContext, StaticContext } from \"./context\";\nvar Grid = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  var data = props.data,\n    onScroll = props.onScroll;\n  var _useContext = useContext(TableContext, ['flattenColumns', 'onColumnResize', 'getRowKey', 'prefixCls', 'expandedKeys', 'childrenColumnName', 'scrollX', 'direction']),\n    flattenColumns = _useContext.flattenColumns,\n    onColumnResize = _useContext.onColumnResize,\n    getRowKey = _useContext.getRowKey,\n    expandedKeys = _useContext.expandedKeys,\n    prefixCls = _useContext.prefixCls,\n    childrenColumnName = _useContext.childrenColumnName,\n    scrollX = _useContext.scrollX,\n    direction = _useContext.direction;\n  var _useContext2 = useContext(StaticContext),\n    sticky = _useContext2.sticky,\n    scrollY = _useContext2.scrollY,\n    listItemHeight = _useContext2.listItemHeight,\n    getComponent = _useContext2.getComponent,\n    onTablePropScroll = _useContext2.onScroll;\n\n  // =========================== Ref ============================\n  var listRef = React.useRef();\n\n  // =========================== Data ===========================\n  var flattenData = useFlattenRecords(data, childrenColumnName, expandedKeys, getRowKey);\n\n  // ========================== Column ==========================\n  var columnsWidth = React.useMemo(function () {\n    var total = 0;\n    return flattenColumns.map(function (_ref) {\n      var width = _ref.width,\n        key = _ref.key;\n      total += width;\n      return [key, width, total];\n    });\n  }, [flattenColumns]);\n  var columnsOffset = React.useMemo(function () {\n    return columnsWidth.map(function (colWidth) {\n      return colWidth[2];\n    });\n  }, [columnsWidth]);\n  React.useEffect(function () {\n    columnsWidth.forEach(function (_ref2) {\n      var _ref3 = _slicedToArray(_ref2, 2),\n        key = _ref3[0],\n        width = _ref3[1];\n      onColumnResize(key, width);\n    });\n  }, [columnsWidth]);\n\n  // =========================== Ref ============================\n  React.useImperativeHandle(ref, function () {\n    var _listRef$current2;\n    var obj = {\n      scrollTo: function scrollTo(config) {\n        var _listRef$current;\n        (_listRef$current = listRef.current) === null || _listRef$current === void 0 || _listRef$current.scrollTo(config);\n      },\n      nativeElement: (_listRef$current2 = listRef.current) === null || _listRef$current2 === void 0 ? void 0 : _listRef$current2.nativeElement\n    };\n    Object.defineProperty(obj, 'scrollLeft', {\n      get: function get() {\n        var _listRef$current3;\n        return ((_listRef$current3 = listRef.current) === null || _listRef$current3 === void 0 ? void 0 : _listRef$current3.getScrollInfo().x) || 0;\n      },\n      set: function set(value) {\n        var _listRef$current4;\n        (_listRef$current4 = listRef.current) === null || _listRef$current4 === void 0 || _listRef$current4.scrollTo({\n          left: value\n        });\n      }\n    });\n    return obj;\n  });\n\n  // ======================= Col/Row Span =======================\n  var getRowSpan = function getRowSpan(column, index) {\n    var _flattenData$index;\n    var record = (_flattenData$index = flattenData[index]) === null || _flattenData$index === void 0 ? void 0 : _flattenData$index.record;\n    var onCell = column.onCell;\n    if (onCell) {\n      var _cellProps$rowSpan;\n      var cellProps = onCell(record, index);\n      return (_cellProps$rowSpan = cellProps === null || cellProps === void 0 ? void 0 : cellProps.rowSpan) !== null && _cellProps$rowSpan !== void 0 ? _cellProps$rowSpan : 1;\n    }\n    return 1;\n  };\n  var extraRender = function extraRender(info) {\n    var start = info.start,\n      end = info.end,\n      getSize = info.getSize,\n      offsetY = info.offsetY;\n\n    // Do nothing if no data\n    if (end < 0) {\n      return null;\n    }\n\n    // Find first rowSpan column\n    var firstRowSpanColumns = flattenColumns.filter(\n    // rowSpan is 0\n    function (column) {\n      return getRowSpan(column, start) === 0;\n    });\n    var startIndex = start;\n    var _loop = function _loop(i) {\n      firstRowSpanColumns = firstRowSpanColumns.filter(function (column) {\n        return getRowSpan(column, i) === 0;\n      });\n      if (!firstRowSpanColumns.length) {\n        startIndex = i;\n        return 1; // break\n      }\n    };\n    for (var i = start; i >= 0; i -= 1) {\n      if (_loop(i)) break;\n    }\n\n    // Find last rowSpan column\n    var lastRowSpanColumns = flattenColumns.filter(\n    // rowSpan is not 1\n    function (column) {\n      return getRowSpan(column, end) !== 1;\n    });\n    var endIndex = end;\n    var _loop2 = function _loop2(_i) {\n      lastRowSpanColumns = lastRowSpanColumns.filter(function (column) {\n        return getRowSpan(column, _i) !== 1;\n      });\n      if (!lastRowSpanColumns.length) {\n        endIndex = Math.max(_i - 1, end);\n        return 1; // break\n      }\n    };\n    for (var _i = end; _i < flattenData.length; _i += 1) {\n      if (_loop2(_i)) break;\n    }\n\n    // Collect the line who has rowSpan\n    var spanLines = [];\n    var _loop3 = function _loop3(_i2) {\n      var item = flattenData[_i2];\n\n      // This code will never reach, just incase\n      if (!item) {\n        return 1; // continue\n      }\n      if (flattenColumns.some(function (column) {\n        return getRowSpan(column, _i2) > 1;\n      })) {\n        spanLines.push(_i2);\n      }\n    };\n    for (var _i2 = startIndex; _i2 <= endIndex; _i2 += 1) {\n      if (_loop3(_i2)) continue;\n    }\n\n    // Patch extra line on the page\n    var nodes = spanLines.map(function (index) {\n      var item = flattenData[index];\n      var rowKey = getRowKey(item.record, index);\n      var getHeight = function getHeight(rowSpan) {\n        var endItemIndex = index + rowSpan - 1;\n        var endItemKey = getRowKey(flattenData[endItemIndex].record, endItemIndex);\n        var sizeInfo = getSize(rowKey, endItemKey);\n        return sizeInfo.bottom - sizeInfo.top;\n      };\n      var sizeInfo = getSize(rowKey);\n      return /*#__PURE__*/React.createElement(BodyLine, {\n        key: index,\n        data: item,\n        rowKey: rowKey,\n        index: index,\n        style: {\n          top: -offsetY + sizeInfo.top\n        },\n        extra: true,\n        getHeight: getHeight\n      });\n    });\n    return nodes;\n  };\n\n  // ========================= Context ==========================\n  var gridContext = React.useMemo(function () {\n    return {\n      columnsOffset: columnsOffset\n    };\n  }, [columnsOffset]);\n\n  // ========================== Render ==========================\n  var tblPrefixCls = \"\".concat(prefixCls, \"-tbody\");\n\n  // default 'div' in rc-virtual-list\n  var wrapperComponent = getComponent(['body', 'wrapper']);\n\n  // ========================== Sticky Scroll Bar ==========================\n  var horizontalScrollBarStyle = {};\n  if (sticky) {\n    horizontalScrollBarStyle.position = 'sticky';\n    horizontalScrollBarStyle.bottom = 0;\n    if (_typeof(sticky) === 'object' && sticky.offsetScroll) {\n      horizontalScrollBarStyle.bottom = sticky.offsetScroll;\n    }\n  }\n  return /*#__PURE__*/React.createElement(GridContext.Provider, {\n    value: gridContext\n  }, /*#__PURE__*/React.createElement(VirtualList, {\n    fullHeight: false,\n    ref: listRef,\n    prefixCls: \"\".concat(tblPrefixCls, \"-virtual\"),\n    styles: {\n      horizontalScrollBar: horizontalScrollBarStyle\n    },\n    className: tblPrefixCls,\n    height: scrollY,\n    itemHeight: listItemHeight || 24,\n    data: flattenData,\n    itemKey: function itemKey(item) {\n      return getRowKey(item.record);\n    },\n    component: wrapperComponent,\n    scrollWidth: scrollX,\n    direction: direction,\n    onVirtualScroll: function onVirtualScroll(_ref4) {\n      var _listRef$current5;\n      var x = _ref4.x;\n      onScroll({\n        currentTarget: (_listRef$current5 = listRef.current) === null || _listRef$current5 === void 0 ? void 0 : _listRef$current5.nativeElement,\n        scrollLeft: x\n      });\n    },\n    onScroll: onTablePropScroll,\n    extraRender: extraRender\n  }, function (item, index, itemProps) {\n    var rowKey = getRowKey(item.record, index);\n    return /*#__PURE__*/React.createElement(BodyLine, {\n      data: item,\n      rowKey: rowKey,\n      index: index,\n      style: itemProps.style\n    });\n  }));\n});\nvar ResponseGrid = responseImmutable(Grid);\nif (process.env.NODE_ENV !== 'production') {\n  ResponseGrid.displayName = 'ResponseGrid';\n}\nexport default ResponseGrid;"]},"metadata":{},"sourceType":"module"}